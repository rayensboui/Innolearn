{% extends 'base.html.twig' %}

{% block title %}Log In - InnoLearn{% endblock %}

{% block body %}
<div class="fixed inset-0 flex bg-[#03060f] overflow-hidden select-none text-white transition-colors duration-700">

    <!-- LEFT : LOCK ANIMATION -->
    <div class="hidden lg:flex w-1/2 relative h-full items-center justify-center border-r border-white/5">

        <div class="absolute inset-0 flex items-center justify-center opacity-20 pointer-events-none">
            <div class="absolute w-[800px] h-[800px] rounded-full border border-blue-500/10 animate-pulse"></div>
            <div class="absolute w-[500px] h-[500px] rounded-full border border-blue-500/20"></div>
        </div>

        <div class="lock-view relative z-10 scale-125 xl:scale-150 transform-gpu">
            <svg width="300" height="300" viewBox="0 0 200 200" class="overflow-visible">

                <!-- SHACKLE (Asymmetrical Legs: Long Hinge, Short Tip) -->
                <path class="shackle"
                      d="M130 75 V55 Q130 30 100 30 Q70 30 70 55 V100"
                      stroke="#3b82f6"
                      stroke-width="14"
                      stroke-linecap="round"
                      fill="none" />

                <!-- BODY -->
                <rect x="50" y="80" width="100" height="85" rx="15"
                      fill="#1e293b"
                      stroke="#3b82f6"
                      stroke-width="3" />

                <!-- OUTER CYLINDER -->
                <circle cx="100" cy="122" r="26"
                        fill="#03060f"
                        stroke="#3b82f6"
                        stroke-width="1.5" />

                <!-- ROTATING MECHANISM -->
                <g class="lock-mechanism">

                    <!-- PLUG -->
                    <circle cx="100" cy="122" r="22"
                            fill="#334155"
                            stroke="#475569"
                            stroke-width="1.5" />

                    <!-- SLOT -->
                    <rect x="88" y="119" width="24" height="6" rx="1.5" fill="#03060f" />

                    <!-- KEY (CALIBRATED GEOMETRY: UNIFIED THICKNESS) -->
                    <g class="key-object">
                        <!-- Handle (Unified width) -->
                        <circle cx="-40" cy="122" r="18"
                                stroke="#f1f5f9"
                                stroke-width="8"
                                fill="none"/>

                        <!-- Shaft (Unified width) -->
                        <line x1="-22" y1="122" x2="65" y2="122"
                              stroke="#f1f5f9"
                              stroke-width="8"
                              stroke-linecap="round" />

                        <!-- Bitting (Unified width) -->
                        <line x1="38" y1="122" x2="38" y2="142"
                              stroke="#f1f5f9"
                              stroke-width="8"
                              stroke-linecap="round" />
                        <line x1="52" y1="122" x2="52" y2="142"
                              stroke="#f1f5f9"
                              stroke-width="8"
                              stroke-linecap="round" />
                    </g>
                </g>
            </svg>
        </div>
    </div>

    <!-- RIGHT: MASCOT BOOK ZONE -->
    <div class="w-full lg:w-1/2 h-full bg-gradient-to-br from-[#6366f1] to-[#4338ca] relative flex flex-col items-center p-8 overflow-hidden lg:rounded-r-[3rem] lg:my-4 lg:mr-4 shadow-2xl">
        
        <!-- Premium Book Spine (Rounded with lighting) -->
        <div class="absolute left-0 top-0 bottom-0 w-28 bg-gradient-to-r from-[#3730a3] via-[#4338ca] to-[#312e81] z-30 shadow-[10px_0_30px_rgba(0,0,0,0.4)] flex flex-col items-center py-10 gap-24">
            <!-- Binding Ribs (Raised effect) -->
            <div class="w-full h-2 bg-[#312e81] shadow-inner opacity-40"></div>
            <div class="w-full h-2 bg-[#312e81] shadow-inner opacity-40 mt-auto"></div>
            <div class="w-full h-2 bg-[#312e81] shadow-inner opacity-40 mb-12"></div>
        </div>

        <!-- The "Groove" (Structural bend line) -->
        <div class="absolute left-28 top-0 bottom-0 w-2 bg-black/20 z-20 blur-[2px]"></div>

        <!-- Authentic Fanned Paper Stack (Right edge) -->
        <div class="absolute right-0 top-0 bottom-0 w-16 bg-[#fefcf3] z-10 rounded-r-[3rem] shadow-[-25px_0_50px_rgba(0,0,0,0.35)] border-l border-black/10 flex overflow-hidden">
            <!-- Random organic page edge simulation -->
            <div class="h-full w-[1px] bg-black/5 ml-[4px]"></div>
            <div class="h-full w-[2px] bg-black/10 ml-[2px]"></div>
            <div class="h-full w-[1px] bg-black/5 ml-[6px]"></div>
            <div class="h-full w-[1px] bg-black/15 ml-[3px]"></div>
            <div class="h-full w-[1px] bg-black/5 ml-[8px]"></div>
            <div class="h-full w-[2px] bg-black/10 ml-[2px]"></div>
            <div class="h-full w-[1px] bg-black/5 ml-[4px]"></div>
            <div class="h-full w-[3px] bg-black/10 ml-[3px] opacity-30"></div>
        </div>

        <!-- Physical Cover Flap Shadow (Creates depth over pages) -->
        <div class="absolute right-16 top-0 bottom-0 w-6 bg-gradient-to-r from-transparent to-black/30 z-20 pointer-events-none"></div>

        <div class="relative z-10 w-full max-w-lg h-full flex flex-col items-center justify-between py-6">

            <!-- LOGO: EMBOSSED EFFECT -->
            <div class="w-full flex justify-center shrink-0">
                <img src="{{ asset('images/logo.png') }}" alt="InnoLearn" class="w-full max-w-[520px] drop-shadow-[0_15px_30px_rgba(0,0,0,0.4)] brightness-125 saturate-125">
            </div>

            <!-- MASCOT FACE: PREMIUM 3D -->
            <div class="flex flex-col items-center shrink-0 my-4">
                <!-- Eyes Container -->
                <div class="mb-8">
                    <svg width="200" height="100" viewBox="0 0 200 100" class="drop-shadow-[0_10px_20px_rgba(0,0,0,0.3)]">
                        <defs>
                            <radialGradient id="eyeDeepMod" cx="50%" cy="50%" r="50%">
                                <stop offset="0%" style="stop-color:white" />
                                <stop offset="70%" style="stop-color:white" />
                                <stop offset="100%" style="stop-color:#e2e8f0" />
                            </radialGradient>
                            <radialGradient id="pupilGradient" cx="30%" cy="30%" r="70%">
                                <stop offset="0%" style="stop-color:#1a1f2e" />
                                <stop offset="100%" style="stop-color:#03060f" />
                            </radialGradient>
                            <filter id="eyeShadow">
                                <feGaussianBlur in="SourceAlpha" stdDeviation="3"/>
                                <feOffset dx="0" dy="3" result="offsetblur"/>
                                <feComponentTransfer>
                                    <feFuncA type="linear" slope="0.3"/>
                                </feComponentTransfer>
                                <feMerge>
                                    <feMergeNode/>
                                    <feMergeNode in="SourceGraphic"/>
                                </feMerge>
                            </filter>
                        </defs>
                        
                        <!-- Left Eye -->
                        <g filter="url(#eyeShadow)">
                            <circle cx="60" cy="50" r="35" fill="url(#eyeDeepMod)" stroke="#cbd5e1" stroke-width="3"/>
                            <circle cx="60" cy="50" r="32" fill="white"/>
                            <g class="pupil-left">
                                <circle cx="60" cy="58" r="15" fill="url(#pupilGradient)"/>
                                <circle cx="65" cy="52" r="6" fill="white" fill-opacity="0.95"/>
                                <circle cx="67" cy="54" r="3" fill="white" fill-opacity="0.7"/>
                            </g>
                            <path d="M 38 35 Q 60 30 82 35" stroke="white" stroke-width="2.5" fill="none" opacity="0.4" stroke-linecap="round"/>
                        </g>
                        
                        <!-- Right Eye -->
                        <g filter="url(#eyeShadow)">
                            <circle cx="140" cy="50" r="35" fill="url(#eyeDeepMod)" stroke="#cbd5e1" stroke-width="3"/>
                            <circle cx="140" cy="50" r="32" fill="white"/>
                            <g class="pupil-right">
                                <circle cx="140" cy="58" r="15" fill="url(#pupilGradient)"/>
                                <circle cx="145" cy="52" r="6" fill="white" fill-opacity="0.95"/>
                                <circle cx="147" cy="54" r="3" fill="white" fill-opacity="0.7"/>
                            </g>
                            <path d="M 118 35 Q 140 30 162 35" stroke="white" stroke-width="2.5" fill="none" opacity="0.4" stroke-linecap="round"/>
                        </g>
                        
                        <!-- Eyebrows -->
                        <path d="M 38 25 Q 60 20 82 25" stroke="#03060f" stroke-width="4" fill="none" opacity="0.3" stroke-linecap="round"/>
                        <path d="M 118 25 Q 140 20 162 25" stroke="#03060f" stroke-width="4" fill="none" opacity="0.3" stroke-linecap="round"/>
                        
                        <!-- Blush marks -->
                        <ellipse cx="25" cy="60" rx="12" ry="8" fill="#ff6b9d" fill-opacity="0.2"/>
                        <ellipse cx="175" cy="60" rx="12" ry="8" fill="#ff6b9d" fill-opacity="0.2"/>
                    </svg>
                </div>
                
                <!-- Mouth Container with Clear Separation -->
                <div class="mt-4">
                    <svg width="120" height="50" viewBox="0 0 120 50" class="drop-shadow-[0_5px_15px_rgba(0,0,0,0.3)]">
                        <defs>
                            <linearGradient id="smileGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                                <stop offset="0%" style="stop-color:#03060f"/>
                                <stop offset="100%" style="stop-color:#1a1f2e"/>
                            </linearGradient>
                            <filter id="mouthShadow">
                                <feGaussianBlur in="SourceAlpha" stdDeviation="2"/>
                                <feOffset dx="0" dy="2" result="offsetblur"/>
                                <feComponentTransfer>
                                    <feFuncA type="linear" slope="0.3"/>
                                </feComponentTransfer>
                                <feMerge>
                                    <feMergeNode/>
                                    <feMergeNode in="SourceGraphic"/>
                                </feMerge>
                            </filter>
                        </defs>
                        <path d="M 30 20 Q 60 35 90 20" 
                              stroke="url(#smileGradient)" 
                              stroke-width="10" 
                              fill="none" 
                              stroke-linecap="round"
                              filter="url(#mouthShadow)"/>
                    </svg>
                </div>
            </div>

            <h1 class="text-white text-6xl font-black tracking-[0.2em] uppercase mb-1 drop-shadow-xl shrink-0 opacity-90">LOG IN</h1>

            <!-- FORM -->
            <form id="loginForm" method="POST" class="w-full flex flex-col gap-6 flex-1 justify-center px-6" novalidate>
                <div class="relative">
                    <input type="text" name="_username"
                           class="w-full bg-white/10 border-4 border-white/20 rounded-full px-10 py-6 text-white text-3xl font-black text-center placeholder-white/50 focus:outline-none focus:bg-white/20 focus:border-white transition-all shadow-lg"
                           placeholder="IDENTIFIER">
                </div>

                <div class="relative">
                    <input type="password" name="_password"
                           class="w-full bg-white/10 border-4 border-white/20 rounded-full px-10 py-6 text-white text-3xl font-black text-center placeholder-white/50 focus:outline-none focus:bg-white/20 focus:border-white transition-all shadow-lg uppercase"
                           placeholder="ACCESS KEY">
                </div>
            </form>

            <!-- CONTROLS -->
            <div class="w-full flex flex-col items-center gap-4 mt-2 shrink-0 pb-2">
                <button type="submit" form="loginForm"
                        class="w-full py-7 rounded-full bg-[#03060f] text-white font-black text-3xl xl:text-4xl hover:bg-black transition-all shadow-2xl active:scale-95 border-4 border-white/10 uppercase tracking-widest">
                    AUTHENTICATE
                </button>

                <a href="{{ path('app_register') }}" class="text-white/80 font-black text-lg border-b-4 border-white/20 hover:border-white/60 hover:text-white transition-all uppercase tracking-tight">
                    NEW UNIT? INITIALIZE NETWORK
                </a>
            </div>
        </div>
    </div>
</div>

<!-- GSAP -->
<script src="https://unpkg.com/gsap@3/dist/gsap.min.js"></script>

<script>
document.addEventListener("DOMContentLoaded", () => {

    const key = document.querySelector(".key-object");
    const mechanism = document.querySelector(".lock-mechanism");
    const shackle = document.querySelector(".shackle");
    const form = document.getElementById("loginForm");
    const inputs = form.querySelectorAll("input");

    let unlocked = false;

    // INITIAL STATES
    gsap.set(key, { x: -10 });
    gsap.set(mechanism, { rotation: 0, svgOrigin: "100 122" });
    gsap.set(shackle, { rotation: 0, y: 0, svgOrigin: "70 80" });

    // INSERTION PROGRESS
    const updateProgress = () => {
        if (unlocked) return;

        const chars = Array.from(inputs)
            .reduce((s, i) => s + i.value.length, 0);

        const progress = Math.min(chars / 12, 1);

        gsap.to(key, {
            x: gsap.utils.interpolate(-10, 55, progress),
            duration: 0.3,
            ease: "power2.out"
        });

        // Dynamic mechanism glow
        gsap.to(mechanism, {
            filter: `drop-shadow(0 0 ${progress * 15}px rgba(59,130,246,${progress * 0.5}))`,
            duration: 0.3
        });
    };

    inputs.forEach(i => i.addEventListener("input", updateProgress));

    // SUBMIT = UNLOCK
    form.addEventListener("submit", (e) => {

        const complete = Array.from(inputs)
            .every(i => i.value.trim().length > 0);

        if (!complete || unlocked) {
            if (!complete) {
                e.preventDefault();
                gsap.fromTo(form, { x: -6 }, {
                    x: 6,
                    duration: 0.05,
                    repeat: 4,
                    yoyo: true
                });
            }
            return;
        }

        unlocked = true;
        e.preventDefault();

        // 1. Force seated and centralized origin
        gsap.set(key, { svgOrigin: "100 122" });
        gsap.to(key, { x: 55, duration: 0.2, ease: "power2.out" });

        const tl = gsap.timeline();

        // 2. Resistance Path (Mechanism carries the key)
        tl.to(mechanism, {
            rotation: -12,
            duration: 0.25,
            ease: "power1.out"
        })
        // 3. Breakthrough
        .to(mechanism, {
            rotation: -72,
            duration: 0.45,
            ease: "power3.out"
        })
        // 4. Settle back
        .to(mechanism, {
            rotation: -65,
            duration: 0.15,
            ease: "power2.inOut"
        })
        // 5. Shackle Pop (Vertical)
        .to(shackle, {
            y: -15, 
            duration: 0.3,
            ease: "back.out(3)"
        }, "-=0.15")
        // 6. Natural Settle
        .to(shackle, {
            rotation: 0,
            duration: 0.1
        }, "-=0.1");
    });

    // MASCOT MOUSE EFFECT
    document.addEventListener("mousemove", (e) => {
        const { clientX, clientY } = e;
        const centerX = window.innerWidth / 2;
        const centerY = window.innerHeight / 2;
        
        const moveX = (clientX - centerX) / centerX;
        const moveY = (clientY - centerY) / centerY;
        
        gsap.to(".pupil-left, .pupil-right", {
            x: moveX * 12,
            y: moveY * 12,
            duration: 0.4,
            ease: "power2.out"
        });
    });
});
</script>
{% endblock %}
